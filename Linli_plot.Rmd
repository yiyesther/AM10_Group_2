---
title: "Linli_plot"
output: html_document
---

# product category analysis
```{r}
#tableau worksheet1
write.csv(ols_clean, "ols_clean.csv")
```

![tableau visualization 1](tableau_vis1.png "tableau visualization 1")


```{r}
#tableau worksheet2

#substring year from timestamp column
ols_clean$year <- substr(ols_clean$order_purchase_timestamp, 1, 4) 

#calculate revenue and goods sold for each product categories
product_sales <- ols_clean %>% 
  mutate(sales = order_item_id*price) %>% 
  group_by(year, product_category_name_english) %>% 
  summarise(volume = n(),
            revenue = sum(sales),
            avg_price = mean(price),
            avg_rating = mean(review_score)) %>% 
  select(product_category_name_english, volume, revenue, avg_price, avg_rating) %>% 
  filter(!is.na(product_category_name_english))

#output the csv file for tableau worksheet2
write.csv(product_sales, "product_sales.csv")
```

![tableau visualization 2](tableau_vis2.png "tableau visualization 2")

![tableau visualization 3](tableau_vis3.png "tableau visualization 3")

![tableau visualization 4](male_clothing_rating.png "tableau visualization 4")
```{r}
#tableau worksheet5

#get all comment messages for fashion_male_clothing
product_review <- ols_raw %>% 
  filter(product_category_name_english == "fashion_male_clothing") %>% 
  select(review_comment_title, review_comment_message)

#glimpse the bag of words
paste(product_review$review_comment_message, collapse=" ")

#transform bag of words into DTM
library(tm)
library(corpus)
review_fmc <- Corpus(VectorSource(product_review$review_comment_message))
inspect(review_fmc[1:5])

DTM_review_fmc <- DocumentTermMatrix(review_fmc, control = list(
            tolower = TRUE,
            removeNumbers = TRUE,
            stopwords = TRUE,
            removePunctuation = TRUE,
            stripWhitespace = TRUE)
)

M <- as.matrix(DTM_review_fmc)
DTM_tbl <- as_tibble(M)

DTM_tbl_tidy <- pivot_longer(DTM_tbl, cols = !que, names_to = "word", values_to = "wordCount")

wordCountDoc <- DTM_tbl_tidy %>%  
        group_by(word) %>% 
        summarise(total = sum(wordCount)) %>% 
        arrange(desc(total)) 

write.csv(wordCountDoc, "fmc.csv")

#translate the column of words from Portuguese to English
translate <- read_csv("translate_fmc.csv")

translate2 <- DTM_tbl_tidy %>% 
  left_join(translate, by = "word")

wordCountDoc2 <- translate2 %>%  
        group_by(en) %>% 
        summarise(total = sum(wordCount)) %>% 
        arrange(desc(total)) %>% 
        filter(en!="product") %>% 
        filter(en!="Good") %>% 
        filter(en!="I asked") %>% 
        filter(en!="bought")

#output the wordcloud
library(wordcloud2)
wordcloud2(data = wordCountDoc2, color = "random-light", backgroundColor = "white") 
```


```{r}
#tableau worksheet6

#get all comment messages for home comfort
product_review <- ols_raw %>% 
  filter(product_category_name_english == "home_comfort_2") %>% 
  select(review_comment_title, review_comment_message)

#glimpse the bag of words
paste(product_review$review_comment_message, collapse=" ")

#transform bag of words into DTM
review_hc <- Corpus(VectorSource(product_review$review_comment_message))
inspect(review_hc[1:5])

DTM_review_hc <- DocumentTermMatrix(review_hc, control = list(
            tolower = TRUE,
            removeNumbers = TRUE,
            stopwords = TRUE,
            removePunctuation = TRUE,
            stripWhitespace = TRUE)
)

M <- as.matrix(DTM_review_hc)
DTM_tbl <- as_tibble(M)

DTM_tbl_tidy <- pivot_longer(DTM_tbl, cols = !que, names_to = "word", values_to = "wordCount")

wordCountDoc <- DTM_tbl_tidy %>%  
        group_by(word) %>% 
        summarise(total = sum(wordCount)) %>% 
        arrange(desc(total)) 
print(wordCountDoc)

write.csv(wordCountDoc, "hc.csv")

#translate the column of words from Portuguese to English
translate <- read_csv("translate_hc.csv")

translate2 <- DTM_tbl_tidy %>% 
  left_join(translate, by = "word")

wordCountDoc2 <- translate2 %>%  
        group_by(en) %>% 
        summarise(total = sum(wordCount)) %>% 
        arrange(desc(total)) %>% 
        filter(en!="product") %>% 
        filter(en!="Good") %>% 
        filter(en!="I asked") %>% 
        filter(en!="bought") %>% 
        filter(en!="mine")


#output the wordcloud
wordcloud2(data = wordCountDoc2, color = "random-light", backgroundColor = "white") 
```


